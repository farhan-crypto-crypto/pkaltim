<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liangpran Console</title>

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Space+Mono&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'earth-dark': '#0F1212',
                        'earth-panel': '#1A2121',
                        'earth-green': '#2D3A3A',
                        'earth-accent': '#8C7E6A',
                        'earth-light': '#F4F1EA',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                        mono: ['Space Mono', 'monospace'],
                    }
                }
            }
        }
    </script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background-color: #0F1212;
            color: #F4F1EA;
        }

        .glass-panel {
            background: rgba(26, 33, 33, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .nav-item.active {
            background: rgba(140, 126, 106, 0.1);
            color: #fff;
            border-right: 2px solid #8C7E6A;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #0F1212;
        }

        ::-webkit-scrollbar-thumb {
            background: #2D3A3A;
            border-radius: 3px;
        }
    </style>
</head>

<body class="antialiased overflow-hidden h-screen flex">

    <!-- LOGIN OVERLAY (Auth Gate) -->
    <div id="login-gate"
        class="fixed inset-0 z-50 flex items-center justify-center bg-[url('./assets/hero-mountain.png')] bg-cover bg-center">
        <div class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>
        <div class="relative z-10 w-full max-w-md glass-panel p-10 rounded-sm shadow-2xl">
            <div class="text-center mb-8">
                <h1 class="font-serif text-3xl italic mb-2">Liangpran.</h1>
                <p class="font-mono text-xs text-earth-accent tracking-[0.2em] uppercase">Enterprise Console</p>
            </div>
            <form id="login-form" class="space-y-6">
                <div>
                    <label class="block font-mono text-xs text-white/50 mb-2">IDENTITY</label>
                    <input type="text" id="username"
                        class="w-full bg-black/20 border border-white/10 p-3 text-sm focus:border-earth-accent outline-none transition-colors"
                        placeholder="admin" required>
                </div>
                <div>
                    <label class="block font-mono text-xs text-white/50 mb-2">ACCESS CODE</label>
                    <input type="password" id="password"
                        class="w-full bg-black/20 border border-white/10 p-3 text-sm focus:border-earth-accent outline-none transition-colors"
                        placeholder="••••" required>
                </div>
                <button type="submit"
                    class="w-full bg-earth-accent hover:bg-[#7a6e5d] text-white py-3 font-mono text-xs uppercase tracking-widest transition-colors">Authenticate</button>
            </form>
            <div id="login-error" class="mt-4 text-center text-red-400 text-xs font-mono hidden">Access Denied: Invalid
                Credentials</div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app-shell" class="flex w-full hidden">

        <!-- SIDEBAR -->
        <aside class="w-64 border-r border-white/5 bg-earth-dark flex flex-col justify-between">
            <div>
                <div class="p-8">
                    <h2 class="font-serif text-xl italic text-white/90">Liangpran.</h2>
                </div>
                <nav class="flex flex-col gap-1 px-4">
                    <button onclick="router('dashboard')"
                        class="nav-item active text-left px-4 py-3 rounded-sm font-mono text-xs text-white/60 hover:text-white transition-all flex items-center gap-3">
                        <span class="w-2 h-2 rounded-full bg-green-500/50"></span> Dashboard
                    </button>
                    <button onclick="router('destinations')"
                        class="nav-item text-left px-4 py-3 rounded-sm font-mono text-xs text-white/60 hover:text-white transition-all flex items-center gap-3">
                        <span class="w-2 h-2 rounded-full border border-white/20"></span> Destinations
                    </button>
                    <button onclick="router('biodiversity')"
                        class="nav-item text-left px-4 py-3 rounded-sm font-mono text-xs text-white/60 hover:text-white transition-all flex items-center gap-3">
                        <span class="w-2 h-2 rounded-full border border-white/20"></span> Biodiversity
                    </button>
                    <button onclick="router('trails')"
                        class="nav-item text-left px-4 py-3 rounded-sm font-mono text-xs text-white/60 hover:text-white transition-all flex items-center gap-3">
                        <span class="w-2 h-2 rounded-full border border-white/20"></span> Trails Analysis
                    </button>
                </nav>
            </div>
            <div class="p-6 border-t border-white/5">
                <div class="flex items-center gap-3 mb-6">
                    <img id="user-avatar" src="" class="w-8 h-8 rounded-full opacity-80" alt="Avatar">
                    <div>
                        <div id="user-name" class="text-sm font-medium">Admin</div>
                        <div id="user-role" class="text-[10px] uppercase tracking-wider opacity-50 font-mono">Super User
                        </div>
                    </div>
                </div>
                <button onclick="System.auth.logout()"
                    class="w-full border border-white/10 py-2 text-xs font-mono hover:bg-white/5 transition-colors">LOGOUT</button>
            </div>
        </aside>

        <!-- CONTENT AREA -->
        <main class="flex-1 overflow-y-auto relative">
            <header
                class="sticky top-0 z-40 bg-earth-dark/80 backdrop-blur-md border-b border-white/5 px-8 py-5 flex justify-between items-center">
                <div class="font-mono text-xs opacity-50 tracking-widest uppercase" id="page-title">System Overview
                </div>
                <div class="flex gap-4">
                    <button onclick="location.reload()" class="p-2 hover:bg-white/5 rounded-full"><svg width="16"
                            height="16" fill="none" class="opacity-50" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg></button>
                    <a href="liangpran-journey.html" target="_blank"
                        class="px-4 py-2 bg-white/5 text-xs font-mono hover:bg-white/10 transition-colors border border-white/5 rounded-sm">View
                        Site &nearr;</a>
                </div>
            </header>

            <div class="p-8 max-w-7xl mx-auto min-h-screen">

                <!-- VIEW: DASHBOARD -->
                <div id="view-dashboard" class="view-section space-y-8 animate-fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Stat Card 1 -->
                        <div class="glass-panel p-6 rounded-sm">
                            <h3 class="font-mono text-xs text-earth-accent mb-1">VISITOR TRAFFIC</h3>
                            <div class="text-3xl font-serif" id="stat-total-visitors">0</div>
                            <div class="text-[10px] text-white/40 mt-2">+12% from last week</div>
                        </div>
                        <!-- Stat Card 2 -->
                        <div class="glass-panel p-6 rounded-sm">
                            <h3 class="font-mono text-xs text-earth-accent mb-1">BIODIVERSITY INDEX</h3>
                            <div class="text-3xl font-serif">A+</div>
                            <div class="text-[10px] text-white/40 mt-2">Stable Condition</div>
                        </div>
                        <!-- Stat Card 3 -->
                        <div class="glass-panel p-6 rounded-sm">
                            <h3 class="font-mono text-xs text-earth-accent mb-1">SYSTEM STATUS</h3>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                <span class="text-lg font-medium">Operational</span>
                            </div>
                        </div>
                    </div>

                    <!-- Chart -->
                    <div class="glass-panel p-6 rounded-sm">
                        <h3 class="font-mono text-xs text-white/50 mb-6">ANALYTICS OVERVIEW</h3>
                        <div class="h-64 w-full">
                            <canvas id="visitorChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- VIEW: BIODIVERSITY -->
                <div id="view-biodiversity" class="view-section hidden space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="font-serif text-2xl">Flora & Fauna Database</h2>
                        <button onclick="alert('Feature coming in V4.1')"
                            class="bg-earth-accent px-5 py-2 text-xs font-mono uppercase text-white hover:bg-[#7a6e5d]">+
                            Add Species</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="bio-grid">
                        <!-- JS Rendered -->
                    </div>
                </div>

                <!-- VIEW: TRAILS (Generic List) -->
                <div id="view-trails" class="view-section hidden space-y-6">
                    <h2 class="font-serif text-2xl">Hiking Trails</h2>
                    <div class="overflow-x-auto glass-panel rounded-sm">
                        <table class="w-full text-left text-sm text-white/70">
                            <thead class="bg-white/5 text-xs uppercase font-mono text-white/50 border-b border-white/5">
                                <tr>
                                    <th class="p-4">Route Name</th>
                                    <th class="p-4">Difficulty</th>
                                    <th class="p-4">Distance</th>
                                    <th class="p-4">Status</th>
                                </tr>
                            </thead>
                            <tbody id="trails-table"></tbody>
                        </table>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- System Logic -->
    <script src="./system.js"></script>
    <script>
        // --- ADMIN CONTROLLER ---

        // Auth Check
        document.addEventListener('DOMContentLoaded', () => {
            if (System.auth.check()) {
                initApp();
            } else {
                document.getElementById('login-gate').classList.remove('hidden');
            }
        });

        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            const res = System.auth.login(u, p);

            if (res.success) {
                initApp();
            } else {
                document.getElementById('login-error').classList.remove('hidden');
            }
        });

        function initApp() {
            document.getElementById('login-gate').classList.add('hidden');
            document.getElementById('app-shell').classList.remove('hidden');

            const user = System.auth.user();
            document.getElementById('user-name').innerText = user.name;
            document.getElementById('user-role').innerText = user.role;
            document.getElementById('user-avatar').src = user.avatar;

            loadDashboard();
        }

        // Router
        window.router = function (view) {
            // Update UI State
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${view}`).classList.remove('hidden');

            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active', 'text-white'));
            event.currentTarget.classList.add('active');

            // Load Data
            if (view === 'dashboard') loadDashboard();
            if (view === 'biodiversity') loadBiodiversity();
            if (view === 'trails') loadTrails();
        }

        function loadDashboard() {
            // Visitors Stats
            const stats = System.analytics.getVisitorStats();
            document.getElementById('stat-total-visitors').innerText = stats.total.toLocaleString();

            // Render Chart
            const ctx = document.getElementById('visitorChart').getContext('2d');

            // Destroy existing chart if any (simple hack for this prototype)
            if (window.myChart) window.myChart.destroy();

            window.myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: stats.labels,
                    datasets: [{
                        label: 'Visitors',
                        data: stats.data,
                        borderColor: '#8C7E6A',
                        backgroundColor: 'rgba(140, 126, 106, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#0F1212',
                        pointBorderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: 'rgba(255,255,255,0.5)', font: { family: 'Space Mono', size: 10 } }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: 'rgba(255,255,255,0.5)', font: { family: 'Space Mono', size: 10 } }
                        }
                    }
                }
            });
        }

        function loadBiodiversity() {
            const data = System.db.get('biodiversity');
            const container = document.getElementById('bio-grid');
            container.innerHTML = data.map(item => `
                <div class="glass-panel overflow-hidden group hover:border-earth-accent/50 transition-colors">
                    <div class="h-48 overflow-hidden relative">
                        <img src="${item.image}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700">
                        <div class="absolute top-3 right-3 bg-black/50 backdrop-blur-md px-3 py-1 text-[10px] font-mono uppercase rounded-full border border-white/10 ${item.status === 'Protected' ? 'text-green-400' : 'text-yellow-400'}">${item.status}</div>
                    </div>
                    <div class="p-5">
                        <div class="font-mono text-[10px] text-white/40 mb-1 uppercase">${item.type} • ${item.scientific}</div>
                        <h3 class="font-serif text-xl mb-2">${item.name}</h3>
                        <p class="text-xs text-white/60 leading-relaxed line-clamp-2">${item.desc}</p>
                    </div>
                </div>
            `).join('');
        }

        function loadTrails() {
            const data = System.db.get('trails');
            const container = document.getElementById('trails-table');
            container.innerHTML = data.map(t => `
                <tr class="border-b border-white/5 hover:bg-white/5 transition-colors">
                    <td class="p-4 font-medium">${t.name}</td>
                    <td class="p-4"><span class="px-2 py-1 rounded-sm bg-white/10 text-[10px] font-mono uppercase">${t.difficulty}</span></td>
                    <td class="p-4 text-xs font-mono text-white/60">${t.distance}</td>
                    <td class="p-4 text-xs text-green-400 font-mono text-[10px] uppercase">● ${t.status}</td>
                </tr>
            `).join('');
        }
    </script>
</body>

</html>